#!/bin/bash
# ================================================================================================
# winhost - Windows Hosts Manager via WSL
# ================================================================================================

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
WINHOSTCTL_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

source "$WINHOSTCTL_DIR/.env"
source "$WINHOSTCTL_DIR/lib/functions"

action="$1"
shift

case "$action" in
  --add|-a)
    domain="$1"
    shift
    ip="${1:-$DEFAULT_IP_ADDRESS}"
    addhost --domain "$domain" --ip "$ip"
    ;;
  --remove|-r)
    domain="$1"
    removehost --domain "$domain"
    ;;
  --help)
    echo
    echo "Windows Hosts Manager via WSL"
    echo "Manage your Windows 'hosts' file from WSL."
    echo
    echo "Usage:"
    echo "  winhost --add <domain> [ip]     Add a domain to the Windows hosts file."
    echo "                                  If no IP is provided, defaults to \$DEFAULT_IP_ADDRESS."
    echo
    echo "  winhost --remove <domain>       Remove a domain from the Windows hosts file."
    echo
    echo "Options:"
    echo "  -a, --add       Add a new host entry"
    echo "  -r, --remove    Remove an existing host entry"
    echo "  -h, --help      Show help message"
    echo
    echo "Examples:"
    echo "  winhost --add domain.test               # Uses default IP"
    echo "  winhost --add domain.test 192.168.0.1   # Uses custom IP"
    echo "  winhost --remove domain.test"
    echo
    ;;
  -h)
    echo
    echo "Usage: winhost [options] <domain> [ip]"
    echo "Options: -a (add), -r (remove), -h (help)"
    echo "Example: winhost -a domain.test"
    echo "         winhost -r domain.test"
    echo "         winhost -h"
    echo
    echo "For more details, use --help"
    echo
    ;;
  *)
    echo "❌ Unknown action: $action"
    echo "Use -h or --help for usage." >&2
    exit 1
    ;;
esac

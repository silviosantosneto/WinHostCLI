#!/bin/bash
# ================================================================================================
# winhost - Windows Hosts Manager
# ================================================================================================

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
WINHOSTCTL_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

source "$WINHOSTCTL_DIR/.env"
source "$WINHOSTCTL_DIR/lib/functions"

action="$1"
shift

case "$action" in
--add|-a)
  domain="$1"
  shift

  comment=""
  ip=""

  for arg in "$1" "$2"; do
    [[ -z "$arg" ]] && continue

    if [[ -z "$(echo "$arg" | tr -d '0-9.')" ]]; then
      ip="$arg"
    else
      comment="$arg"
    fi
  done

  ip="${ip:-$DEFAULT_IP_ADDRESS}"

  addhost --domain "$domain" --ip "$ip" --comment "$comment"
  ;;

  --remove|-r)
    domain="$1"
    removehost --domain "$domain"
    ;;
  --help)
    msg help LONG
    ;;
  -h)
    msg help SHORT
    ;;
  *)
    msg error UNKNOWN_ACTION >&2
    exit 1
    ;;
esac
